<!-- app/templates/tools/usa/usa_broken_links.html -->
<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
      <title>MC-Mutual - Dashboard</title>
      <meta name="description" content="" />

      <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

      <link rel="stylesheet" href="{{ url_for('static', filename='dist/css/styles.css') }}" />
   
     <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"> -->
      <link rel="stylesheet" href="{{ url_for('static', filename='custom/colors.css') }}" />
      <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
      <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">

     
      <script>
         // Recuperar el estado del collapse del localStorage para cada elemento colapsable
         document.addEventListener('DOMContentLoaded', function () {
           var collapseStates = JSON.parse(localStorage.getItem('collapseStates')) || {};
         
           // Iterar sobre cada collapse y aplicar el estado correspondiente
           Object.keys(collapseStates).forEach(function (collapseId) {
             if (collapseStates[collapseId]) {
               $('#' + collapseId).addClass('show');
             }
           });
         
           // Manejar eventos del collapse para actualizar el localStorage
           $('.collapse').on('show.bs.collapse', function () {
             var collapseId = $(this).attr('id');
             collapseStates[collapseId] = true;
             localStorage.setItem('collapseStates', JSON.stringify(collapseStates));
           });
         
           $('.collapse').on('hide.bs.collapse', function () {
             var collapseId = $(this).attr('id');
             collapseStates[collapseId] = false;
             localStorage.setItem('collapseStates', JSON.stringify(collapseStates));
           });
         });
      </script>
      <style>
         /* Estilo para las tarjetas de ScanResults */
         .scan-result-card {
             background-color: #e9ecef; /* Color de fondo gris claro */
             border: 1px solid #ced4da; /* Borde gris */
             margin-bottom: 20px; /* Margen inferior */
         }
     
         /* Estilo para las tarjetas de DomainStats */
         .domain-stat-card {
             background-color: #d4edda; /* Color de fondo verde claro */
             border: 1px solid #c3e6cb; /* Borde verde */
             margin-bottom: 20px; /* Margen inferior */
         }
     </style>
   </head>
   <body class="sb-nav-fixed">
      {% if current_user.is_authenticated %}
      <!-- Info Bar -->
      <nav class="sb-topnav navbar navbar-expand navbar-light bg-light">
         <!-- Navbar Brand-->
         <a class="navbar-brand ps-3" href="/">
         <img src="{{ url_for('static', filename='images/logo_MC.png') }}" alt="MC Mutua" />
         </a>
         <!-- Sidebar Toggle-->
         <button class="btn btn-link btn-sm order-1 order-lg-0 me-4 me-lg-0" id="sidebarToggle" href="#!"><i class="fas fa-bars"></i></button>
         <!-- Navbar-->
         <div class="container-fluid">
            <div class="d-flex justify-content-between align-items-center w-100">
               <!-- Navbar Search
                  <div class="me-auto">
                      <form class="d-none d-md-inline-block form-inline ms-auto me-0 me-md-3 my-2 my-md-0">
                          <div class="input-group">
                              <input class="form-control" type="text" placeholder="buscar..." aria-label="buscar..." aria-describedby="btnNavbarSearch" />
                              <button class="btn btn-primary" id="btnNavbarSearch" type="button"><i class="fas fa-search"></i></button>
                          </div>
                      </form>
                  </div> -->
               <!-- PDF 
                  <div class="d-flex">
                      <div class="pdf-btn me-3">
                        <form action="#" method="post">
                             <button type="submit" class="btn btn-primary">Generar PDF</button>
                        </form>
                      </div>
                  </div>
                  -->
            </div>
         </div>
         <div class="d-flex">
            <div class="pdf-btn me-3">
               <a href="{{ url_for('generate_pdf') }}" class="btn btn-info" target="_blank">PDF</a>
            </div>
            <!--
               <div class="pdf-btn me-3">
                   <form action="#" method="post">
                        <button type="submit" class="btn btn-primary">EMAIL</button>
                   </form>
               </div>
               <div class="pdf-btn me-3">
                   <form action="#" method="post">
                        <button type="submit" class="btn btn-primary">CSV</button>
                   </form>
               </div>
               -->
         </div>
         <!--
            <ul class="navbar-nav d-none d-md-inline-block ms-auto me-0">
                <li>
                    <a class="nav-item" href="{{ url_for('logout') }}">{{ current_user.username }}(<strong>Salir</strong>)</a>
                </li>
            </ul>
            -->
         <a class="nav-item" href="{{ url_for('logout') }}"><strong>Salir</strong></a>
      </nav>
      {% endif %}
      <div id="layoutSidenav">
         {% if current_user.is_authenticated %}
         <div id="layoutSidenav_nav">
            <nav class="sb-sidenav accordion sb-sidenav-light" id="sidenavAccordion">
               {% include 'inc/nav.html' %}
            </nav>
         </div>
         {% endif %}
         <div id="layoutSidenav_content">
            <main>
               <div class="container-fluid px-4">
                  <!-- <div>
                     <ol class="breadcrumb mb-4">
                         <li class="breadcrumb-item"><a href="/">Inicio</a></li>
                         <li class="breadcrumb-item active">estoy aqui</li>
                     </ol>
                     </div>
                     -->
                  <div class="card mt-5">
                     <div class="card-body">
                        <div>
                           <p class="text-center">
                              <!-- alert box -->
                              {% with messages = get_flashed_messages(with_categories=true) %}
                              {% if messages %}
                              {% for category, message in messages %}
                           <div class="alert alert-{{ category }}">
                              {{ message }}
                           </div>
                           {% endfor %}
                           {% endif %}
                           {% endwith %}
                           </p>
                        </div>
                        <h1 class="mt-4">Enlaces rotos</h1>
                        <div class="card control-card mb-4">
                           <div class="card-body">
                              <!-- Status Section -->
                              <div class="mb-3 status-section">
                                 <div>
                                    <i class="fas fa-info-circle status-icon text-primary"></i>
                                    <span class="status-text">Estado: <strong>Activo</strong></span>
                                 </div>
                                 <!-- Last Execution Section -->
                                 <div>
                                    <i class="fas fa-history status-icon text-success"></i>
                                    <span class="status-text">Ultima ejecución: <strong>{{ first_end_time }}</strong></span>
                                 </div>
                              </div>
                              <!-- Control Buttons -->
                              <div class="control-buttons">
                                 <button class="btn btn-primary" type="button"><i class="fas fa-play"></i> Start</button>
                                 <button class="btn btn-warning" type="button"><i class="fas fa-pause"></i> Pause</button>
                                 <button class="btn btn-danger" type="button"><i class="fas fa-stop"></i> Stop</button>
                              </div>
                           </div>
                        </div>
                        <ol class="breadcrumb mb-4">
                           <li class="breadcrumb-item active">Busca enlaces rotos en el sitio</li>
                        </ol>
                        <div class="row">
                           <!-- Itera sobre los últimos resultados de DomainStats -->
                           {% for stat in latest_stats %}
                               <div class="col-md-4 mb-4">
                                   <div class="card domain-stat-card">
                                       <div class="card-body">
                                           <h5 class="card-title">{{ stat.domain }}</h5>
                                           <p class="card-text">
                                               <strong>Timestamp:</strong> {{ stat.latest_timestamp }}<br>
                                               <strong>Status Code:</strong> {{ stat.status_code }}<br>
                                               <strong>Page Count:</strong> {{ stat.page_count }}<br />
                                               <strong>Broken_links:</strong> {{ stat.broken_links }}<br />
                                               <strong>Start Time:</strong> {{ stat.start_time }}<br>
                                               <strong>End Time:</strong> {{ stat.end_time }}<br>
                                               <strong>Total Time:</strong> {{ stat.total_time }}<br>

                                               <!-- Agrega otros campos según sea necesario -->
                                           </p>
                                       </div>
                                   </div>
                               </div>
                           {% endfor %}
                       </div>


                       <div class="row">
                        <!-- Enlaces Rotos -->
                        <div class="col-md-4">
                            <div class="card">
                              <div class="card-header bg-dark text-white">
                                    Enlaces Rotos
                                </div>
                                <div class="card-body">
                                    <canvas id="enlacesRotosChart"></canvas>
                                </div>
                                <div class="card-footer small text-muted">Datos de: prevencion.mc-mutual.com, mejoratuabsentismo.mc-mutual.com, www.mc-mutual.com</div>
                            </div>
                        </div>
                
                        <!-- Tiempo de Escaneo -->
                        <div class="col-md-4">
                            <div class="card">
                              <div class="card-header bg-dark text-white">
                                    Tiempo de Escaneo
                                </div>
                                <div class="card-body">
                                    <canvas id="tiempoEscaneoChart"></canvas>
                                </div>
                                <div class="card-footer small text-muted">Datos de: prevencion.mc-mutual.com, mejoratuabsentismo.mc-mutual.com, www.mc-mutual.com</div>
                            </div>
                        </div>
                
                        <!-- Total de URLs -->
                        <div class="col-md-4">
                            <div class="card">
                              <div class="card-header bg-dark text-white">
                                    Total de URLs
                                </div>
                                <div class="card-body">
                                    <canvas id="totalUrlsChart"></canvas>
                                </div>
                                <div class="card-footer small text-muted">Datos de: prevencion.mc-mutual.com, mejoratuabsentismo.mc-mutual.com, www.mc-mutual.com</div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                     <!-- Enlaces Rotos (dominio individual) -->
                     <div class="col-md-4">
                         <div class="card">
                           <div class="card-header bg-dark text-white">
                                 Enlaces Rotos - prevencion.mc-mutual.com
                             </div>
                             <div class="card-body">
                                 <canvas id="enlacesRotosIndividualChart"></canvas>
                             </div>
                             <div class="card-footer small text-muted">Proporción de enlaces rotos en prevencion.mc-mutual.com</div>
                         </div>
                     </div>
             
                     <!-- Tiempo de Escaneo (dominio individual) -->
                     <div class="col-md-4">
                         <div class="card">
                           <div class="card-header bg-dark text-white">
                                 Tiempo de Escaneo - prevencion.mc-mutual.com
                             </div>
                             <div class="card-body">
                                 <canvas id="tiempoEscaneoIndividualChart"></canvas>
                             </div>
                             <div class="card-footer small text-muted">Proporción de tiempo de escaneo en prevencion.mc-mutual.com</div>
                         </div>
                     </div>
             
                     <!-- Duración Promedio por Página -->
                     <div class="col-md-4">
                         <div class="card">
                           <div class="card-header bg-dark text-white">
                                 Duración Promedio por Página
                             </div>
                             <div class="card-body">
                                 <canvas id="duracionPromedioChart"></canvas>
                             </div>
                             <div class="card-footer small text-muted">Datos de: prevencion.mc-mutual.com, mejoratuabsentismo.mc-mutual.com, www.mc-mutual.com</div>
                         </div>
                     </div>
                 </div>

                 <div class="row">
                  <!-- Score Global - prevencion.mc-mutual.com -->
                  <div class="col-md-4">
                      <div class="card">
                          <div class="card-header bg-dark text-white">
                              Score Global - prevencion.mc-mutual.com
                          </div>
                          <div class="card-body">
                              <canvas id="scoreGlobalChartPrevencion"></canvas>
                          </div>
                          <div class="card-footer small text-muted">Datos de: prevencion.mc-mutual.com</div>
                      </div>
                  </div>
          
                  <!-- Score Global - mejoratuabsentismo.mc-mutual.com -->
                  <div class="col-md-4">
                      <div class="card">
                          <div class="card-header bg-dark text-white">
                              Score Global - mejoratuabsentismo.mc-mutual.com
                          </div>
                          <div class="card-body">
                              <canvas id="scoreGlobalChartMejora"></canvas>
                          </div>
                          <div class="card-footer small text-muted">Datos de: mejoratuabsentismo.mc-mutual.com</div>
                      </div>
                  </div>
          
                  <!-- Score Global - www.mc-mutual.com -->
                  <div class="col-md-4">
                      <div class="card">
                          <div class="card-header bg-dark text-white">
                              Score Global - www.mc-mutual.com
                          </div>
                          <div class="card-body">
                              <canvas id="scoreGlobalChartWww"></canvas>
                          </div>
                          <div class="card-footer small text-muted">Datos de: www.mc-mutual.com</div>
                      </div>
                  </div>
              </div>

              <script>
               // Datos para los gráficos
               var enlacesRotosData = {
                   labels: ["prevencion.mc-mutual.com", "mejoratuabsentismo.mc-mutual.com", "www.mc-mutual.com"],
                   datasets: [{
                       label: "Enlaces Rotos",
                       backgroundColor: ["#FFC0CB", "#98FB98", "#ADD8E6"],
                       data: [53, 19, 9]
                   }]
               };
           
               var tiempoEscaneoData = {
                   labels: ["prevencion.mc-mutual.com", "mejoratuabsentismo.mc-mutual.com", "www.mc-mutual.com"],
                   datasets: [{
                       label: "Tiempo de Escaneo",
                       backgroundColor: ["#FFC0CB", "#98FB98", "#ADD8E6"],
                       data: [4*60 + 19 + 56, 8 + 59, 2*60 + 14 + 57]
                   }]
               };
           
               var totalUrlsData = {
                   labels: ["prevencion.mc-mutual.com", "mejoratuabsentismo.mc-mutual.com", "www.mc-mutual.com"],
                   datasets: [{
                       label: "Total de URLs",
                       backgroundColor: ["#FFC0CB", "#98FB98", "#ADD8E6"],
                       data: [784, 172, 1154]
                   }]
               };
           
               var enlacesRotosIndividualData = {
                   labels: ["Enlaces Rotos", "Páginas Restantes"],
                   datasets: [{
                       data: [53, 784 - 53],
                       backgroundColor: ["#FFC0CB", "#98FB98"]
                   }]
               };
           
               var tiempoEscaneoIndividualData = {
                   labels: ["Tiempo de Escaneo", "Tiempo Restante"],
                   datasets: [{
                       data: [4*60 + 19 + 56, (4*60 + 19 + 56) - (4*60 + 19 + 56)],
                       backgroundColor: ["#FFC0CB", "#98FB98"]
                   }]
               };
           
               var duracionPromedioData = {
        labels: ["Duración Promedio por Página"],
        datasets: [{
            label: "prevencion.mc-mutual.com",
            backgroundColor: "#FFC0CB",
            data: [4*60 + 19 + 56 / 784]
        }, {
            label: "mejoratuabsentismo.mc-mutual.com",
            backgroundColor: "#98FB98",
            data: [8 + 59 / 172]
        }, {
            label: "www.mc-mutual.com",
            backgroundColor: "#ADD8E6",
            data: [2*60 + 14 + 57 / 1154]
        }]
    };

    var scoreGlobalDataPrevencion = {
        labels: ["Enlaces Rotos", "Tiempo de Escaneo (minutos)", "Duración Promedio por Página"],
        datasets: [{
            label: "prevencion.mc-mutual.com",
            backgroundColor: "rgba(255,192,203,0.5)",
            borderColor: "rgba(255,192,203,1)",
            pointBackgroundColor: "rgba(255,192,203,1)",
            data: [53, 4 * 60 + 19 + 56, 4 * 60 + 19 + 56 / 784]
        }]
    };

    var scoreGlobalDataMejora = {
        labels: ["Enlaces Rotos", "Tiempo de Escaneo (minutos)", "Duración Promedio por Página"],
        datasets: [{
            label: "mejoratuabsentismo.mc-mutual.com",
            backgroundColor: "rgba(152,251,152,0.5)",
            borderColor: "rgba(152,251,152,1)",
            pointBackgroundColor: "rgba(152,251,152,1)",
            data: [19, 8 + 59, 8 + 59 / 172]
        }]
    };
    var scoreGlobalDataWww = {
        labels: ["Enlaces Rotos", "Tiempo de Escaneo (minutos)", "Duración Promedio por Página"],
        datasets: [{
            label: "www.mc-mutual.com",
            backgroundColor: "rgba(173,216,230,0.5)",
            borderColor: "rgba(173,216,230,1)",
            pointBackgroundColor: "rgba(173,216,230,1)",
            data: [9, 2 * 60 + 14 + 57, 2 * 60 + 14 + 57 / 1154]
        }]
    };

    // Gráficos
    var enlacesRotosChart = new Chart(document.getElementById('enlacesRotosChart').getContext('2d'), {
        type: 'bar',
        data: enlacesRotosData
    });

    var tiempoEscaneoChart = new Chart(document.getElementById('tiempoEscaneoChart').getContext('2d'), {
        type: 'bar',
        data: tiempoEscaneoData
    });

    var totalUrlsChart = new Chart(document.getElementById('totalUrlsChart').getContext('2d'), {
        type: 'bar',
        data: totalUrlsData
    });

    var enlacesRotosIndividualChart = new Chart(document.getElementById('enlacesRotosIndividualChart').getContext('2d'), {
        type: 'doughnut',
        data: enlacesRotosIndividualData
    });

    var tiempoEscaneoIndividualChart = new Chart(document.getElementById('tiempoEscaneoIndividualChart').getContext('2d'), {
        type: 'doughnut',
        data: tiempoEscaneoIndividualData
    });

    var duracionPromedioChart = new Chart(document.getElementById('duracionPromedioChart').getContext('2d'), {
        type: 'bar',
        data: duracionPromedioData
    });
  
    var scoreGlobalChartPrevencion = new Chart(document.getElementById('scoreGlobalChartPrevencion').getContext('2d'), {
      type: 'radar',
        data: scoreGlobalDataPrevencion,
        options: {
            scale: {
                ticks: { beginAtZero: true }
            }
        }
    });

    var scoreGlobalChartMejora = new Chart(document.getElementById('scoreGlobalChartMejora').getContext('2d'), {
        type: 'radar',
        data: scoreGlobalDataMejora,
        options: {
            scale: {
                ticks: { beginAtZero: true }
            }
        }
    });

    var scoreGlobalChartWww = new Chart(document.getElementById('scoreGlobalChartWww').getContext('2d'), {
        type: 'radar',
        data: scoreGlobalDataWww,
        options: {
            scale: {
                ticks: { beginAtZero: true }
            }
        }
    });
</script>




                       <div class="row mt-5">
                        <!-- Primera columna con los checkboxes -->
                        <div class="col-md-4 mb-4">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">URL:</h5>
                                    <!-- Agregamos el dropdown en lugar de checkboxes -->
                                    <select id="targetUrlDropdown" class="form-select">
                                        <option value="">Ver todas</option>
                                        <option value="https://www.mc-mutual.com">www.mc-mutual.com</option>
                                        <option value="https://mejoratuabsentismo.mc-mutual.com">mejoratuabsentismo.mc-mutual.com</option>
                                        <option value="https://prevencion.mc-mutual.com">prevencion.mc-mutual.com</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    
                        <!-- Segunda columna con los campos de fecha -->
                        <div class="col-md-4 mb-4">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Desde:</h5>
                                    <input type="date" id="startDate" class="form-control" />
                                </div>
                            </div>
                        </div>
                    
                        <div class="col-md-4 mb-4">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Hasta:</h5>
                                    <input type="date" id="endDate" class="form-control" />
                                </div>
                            </div>
                        </div>
                        <div class="row mb-4">
                            <div class="col-md-12 text-end">
                                <button type="button" class="btn btn-secondary" id="resetFilters">Resetear Filtros</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mb-4">
                     <div class="card-header">
                        <i class="fas fa-table me-1"></i>
                        Enlaces rotos desde el último scan
                     </div>
                     <div class="card-body">
                        <table id="datatablesSimple" class="display">
                           <thead>
                                 <tr>
                                    <th>Fecha</th>
                                    <th>Origen</th>
                                    <th>Url rota</th>
                                    <th>Anchor</th>
                                    <th>Error</th>
                                    <th>Acciones</th>
                                 </tr>

                           </thead>
                           <tfoot>
                                 <tr>
                                    <th>Fecha</th>
                                    <th>Origen</th>
                                    <th>Url rota</th>
                                    <th>Anchor</th>
                                    <th>Error</th>
                                    <th>Acciones</th>
                                 </tr>
                              </tfoot>
                              <tbody>
                                 {% for result in scan_results %}
                                 <tr>
                                     <td>{{ result.timestamp }}</td>
                                     <td>{{ result.scanned_url }}</td>
                                     <td><a href="{{ result.broken_url }}" target="_blank">{{ result.broken_url }}</a></td>
                                     <td>{{ result.anchor_text }}</td>
                                     <td>{{ result.error_code }}</td>
                                     <td>
                                         <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#infoModal{{ result.id }}">
                                             <i class="fas fa-plus"></i>
                                         </button>
                                     </td>
                                 </tr>
                                 <!-- Modal específico para cada fila -->
                                 <div class="modal fade" id="infoModal{{ result.id }}" tabindex="-1" aria-labelledby="infoModalLabel{{ result.id }}" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered">
                                       <div class="modal-content bg-info text-dark">
                                          <div class="modal-header">
                                                <h5 class="modal-title" id="infoModalLabel{{ result.id }}">Sugerencias</h5>
                                                
                                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                          </div>
                                          <div class="modal-body">
                                                <p>Anchor: {{ result.anchor_text }}</p>
                                                <p>Error: {{ result.error_code }}</p>
                                          </div>
                                       </div>
                                    </div>
                              </div>
                              {% endfor %}
                             </tbody>
                        </table>
                  </div>
               </div>

               <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
               <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
               <script src="https://cdn.datatables.net/datetime/1.5.1/js/dataTables.dateTime.min.js"></script>
               <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>


               <script>
                  document.addEventListener('DOMContentLoaded', function() {
                     // Inicializamos DataTables
                     const dataTable = $('#datatablesSimple').DataTable({
                        "language": {
                              "sEmptyTable":     "No hay datos disponibles en la tabla",
                              "sInfo":           "Mostrando _START_ a _END_ de _TOTAL_ entradas",
                              "sInfoEmpty":      "Mostrando 0 a 0 de 0 entradas",
                              "sInfoFiltered":   "(filtrado de un total de _MAX_ entradas)",
                              "sInfoPostFix":    "",
                              "sInfoThousands":  ",",
                              "sLengthMenu":     "Mostrar _MENU_ entradas",
                              "sLoadingRecords": "Cargando...",
                              "sProcessing":     "Procesando...",
                              "sSearch":         "Buscar:",
                              "sZeroRecords":    "No se encontraron coincidencias",
                              "oPaginate": {
                                 "sFirst":    "Primero",
                                 "sLast":     "Último",
                                 "sNext":     "Siguiente",
                                 "sPrevious": "Anterior"
                              },
                              "oAria": {
                                 "sSortAscending":  ": Activar para ordenar la columna en orden ascendente",
                                 "sSortDescending": ": Activar para ordenar la columna en orden descendente"
                              }
                        },responsive:true,
                        columns: [
                              { type: 'date', format: 'YYYY-MM-DD' },
                              null, null, null, null,null
                        ]
                     });

                     // Configuramos el evento de cambio para el dropdown y campos de fecha
                     $('#targetUrlDropdown, #startDate, #endDate').change(updateFilter);

                     // Configuramos el evento de click para el botón de reset
                     $('#resetFilters').click(function() {
                              // Limpiamos los valores de los controles y actualizamos el filtro
                              $('#targetUrlDropdown').val('');
                              $('#startDate').val('');
                              $('#endDate').val('');
                              updateFilter();
                     });

                             // Inicializamos los tooltips de Bootstrap
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        });


                     function updateFilter() {
                        var selectedTarget = $('#targetUrlDropdown').val();
                        var startDate = $('#startDate').val();
                        var endDate = $('#endDate').val();

                        // Aplicamos el filtro de URL
                        dataTable.column(1).search(selectedTarget).draw();

                        

                        // Filtramos por rango de fechas
                        if (startDate && endDate) {
                              dataTable.draw();
                              var columnIndex = 0; // Índice de la columna de fecha
                              var startMoment = moment(startDate, 'YYYY-MM-DD');
                              var endMoment = moment(endDate, 'YYYY-MM-DD');

                              // Filtramos las filas según el rango de fechas
                              $.fn.dataTable.ext.search.push(function (settings, data, dataIndex) {
                                 var dateValue = moment(data[columnIndex], 'YYYY-MM-DD');
                                 return dateValue.isBetween(startMoment, endMoment, null, '[]');
                              });

                              // Redibujamos la tabla
                              dataTable.draw();

                              // Eliminamos la función de filtrado para que no interfiera con futuros cambios
                              $.fn.dataTable.ext.search.pop();
                        } else {
                              // No hay rango de fechas, mostramos todas las filas
                              dataTable.draw();
                        }
                     }
                  });
               </script>



                     </div>
                  </div>
               </div>
            </main>
            <footer class="py-4 bg-light mt-auto">
               <div class="container-fluid px-4">
                  <div class="d-flex align-items-center justify-content-between small">
                     <div class="text-muted">Copyright &copy; MC-Mutual 2023</div>
                     <div>
                        <a href="#">Aviso Legal</a>
                        &middot;
                        <a href="#">Términos &amp; Condiciones</a>
                     </div>
                  </div>
               </div>
            </footer>
         </div>
      </div>
   </body>
</html>


